#:import ListAdapter kivy.adapters.listadapter.ListAdapter

<CLabel@Label>:
    markup: True
    text_size: (self.width, None)

<CListItemButton@ListItemButton>:
    halign: 'center'
    markup: True
    deselected_color: .7, .7, 1, 1
    text_size: (self.width, None)
    height: 50
    size_hint_y: None
    popup_edit: root.data['root_list'].popup_edit_item

    on_release:
        self.popup_edit.data = root.data
        self.popup_edit.title = 'Edit task.'
        self.popup_edit.open()

    GridLayout:
        # set grid size
        cols: 2
        rows: 2

        pos: (self.parent.x + 10, self.parent.y)
        size: (self.parent.width - 20, self.parent.height)
        orientation: 'horizontal'

        # show title (up-left)
        CLabel:
            text: '%s. [b]%s[/b]' % (root.data['row'], root.data['title'])
            font_size: "20dp"
            halign: 'left'

        # show status (up-right)
        CLabel:
            text: '[b]%s[/b]' % root.data['status'].upper()
            color: (0.0, 0.5, 1.0, 1.0)
            halign: 'right'

        # show created date (bottom-left)
        CLabel:
            text: str(root.data['created'])
            halign: 'left'

        # show due date (bottom-right)
        CLabel:
            text: str(root.data['due'])
            halign: 'right'

<LabeledInput@GridLayout>:
    cols: 2

    label_text: ''
    input_text: ''

    size_hint_y: None
    height: 35

    Label:
        text: root.label_text

    TextInput:
        text: root.input_text
        multiline: False

GridLayout:
    id: gl
    cols: 1
    rows: 1
    CListView:
        popup_edit_item: popup_edit_item.__self__

    CPopup:
        id: popup_edit_item
        on_parent: if self.parent == gl: gl.remove_widget(self)
        title: "Add/Edit task: "
        content: popup_content
        GridLayout:
            id: popup_content
            rows: 2
            cols: 1

            GridLayout:
                cols: 1
                get_data: lambda k: '' if k not in popup_edit_item.data else str(popup_edit_item.data[k])

                LabeledInput:
                    label_text: 'Title:'
                    input_text: self.parent.get_data('title')

                LabeledInput:
                    label_text: 'Description:'
                    input_text: self.parent.get_data('body')

                LabeledInput:
                    label_text: 'Created date:'
                    input_text: self.parent.get_data('created')

                LabeledInput:
                    label_text: 'Due date:'
                    input_text: self.parent.get_data('due')

                LabeledInput:
                    label_text: 'Status:'
                    input_text: self.parent.get_data('status')


            GridLayout:
                size_hint: None, None
                width: self.parent.width
                height: 30
                rows: 1
                cols: 2
                Button:
                    text: "Save"
                    background_color: 0.3, 1, 0.3, 1

                Button:
                    text: "Cancel"
                    background_color: 1.5, 0.3, 0.3, 1
                    on_release: popup_edit_item.dismiss()
